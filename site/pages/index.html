<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReFi DAO - A Network Society to Regenerate the Earth</title>
  <meta name="description" content="ReFi DAO is a network society focused on developing strategic services and public goods for the Regenerative Finance ecosystem.">
  
  <!-- Open Graph -->
  <meta property="og:title" content="ReFi DAO - A Network Society to Regenerate the Earth">
  <meta property="og:description" content="Connecting regenerative movements globally, empowering communities to co-create a future rooted in social equity, economic opportunity, and ecological restoration.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://refidao.com">
  <meta property="og:image" content="https://refidao.com/assets/og-image.png">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@ReFiDAOist">
  
  <!-- Favicon -->
  <link rel="icon" href="../assets/favicon.png" type="image/png">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../../refi-node-map/style.css">
</head>
<body class="is-loading">
  <div class="bg-noise"></div>
  
  <!-- NAVIGATION -->
  <nav class="nav" role="navigation" aria-label="Main navigation">
    <div class="nav__container">
      <a href="index.html" class="nav__logo">
        <img src="../assets/logo-wordmark-white.svg" alt="ReFi DAO" class="nav__logo-img nav__logo-img--wordmark">
        
      </a>
      
      <ul class="nav__menu">
        <!-- About -->
        <li class="nav__item">
          <a href="about.html" class="nav__link">About</a>
        </li>
        
        <!-- Local Nodes -->
        <li class="nav__item">
          <a href="local-nodes.html" class="nav__link">Local Nodes</a>
        </li>
        
        <!-- Community -->
        <li class="nav__item">
          <a href="community.html" class="nav__link">Community</a>
        </li>
        
        <!-- Resources Hub -->
        <li class="nav__item">
          <a href="resources-hub.html" class="nav__link">Resources</a>
        </li>
        
        <!-- Media Dropdown -->
        <li class="nav__item">
          <a href="#" class="nav__link">
            Media
            <svg class="nav__link-icon" viewBox="0 0 12 12" fill="none">
              <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
          <div class="nav__dropdown">
            <a href="https://blog.refidao.com" target="_blank" class="nav__dropdown-link nav__dropdown-link--external">
              <span>ReFi Blog</span>
            </a>
            <a href="https://podcast.refidao.com" target="_blank" class="nav__dropdown-link nav__dropdown-link--external">
              <span>ReFi Podcast</span>
            </a>
          </div>
        </li>
        
        <!-- Forum (External) -->
        <li class="nav__item">
          <a href="https://forum.refidao.com" target="_blank" class="nav__link nav__link--external">Forum</a>
        </li>
      </ul>
      
      <div class="nav__actions">
        <a href="join-the-network.html" class="btn btn-primary btn-sm">Join the Network</a>
      </div>
      
      <button class="nav__toggle" aria-label="Open menu" aria-expanded="false">
        <svg class="nav__toggle-icon" viewBox="0 0 24 24" fill="none">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </nav>
  
  <!-- MOBILE MENU -->
  <div class="mobile-menu" role="dialog" aria-modal="true" aria-label="Navigation menu">
    <div class="mobile-menu__header">
      <a href="index.html" class="nav__logo">
        <img src="../assets/logo-wordmark-white.svg" alt="ReFi DAO" class="nav__logo-img nav__logo-img--wordmark">
      </a>
      <button class="mobile-menu__close" aria-label="Close menu">√ó</button>
    </div>
    
    <nav class="mobile-menu__nav">
      <a href="about.html" class="mobile-menu__link">About</a>
      <a href="local-nodes.html" class="mobile-menu__link">Local Nodes</a>
      <a href="community.html" class="mobile-menu__link">Community</a>
      <a href="resources-hub.html" class="mobile-menu__link">Resources</a>
      
      <a href="#" class="mobile-menu__link" data-submenu="mobile-media-menu">
        Media
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </a>
      <div id="mobile-media-menu" class="mobile-menu__submenu">
        <a href="https://blog.refidao.com" target="_blank" class="mobile-menu__sublink">ReFi Blog ‚Üó</a>
        <a href="https://podcast.refidao.com" target="_blank" class="mobile-menu__sublink">ReFi Podcast ‚Üó</a>
      </div>
      
      <a href="https://forum.refidao.com" target="_blank" class="mobile-menu__link">Forum ‚Üó</a>
    </nav>
    
    <div class="mobile-menu__cta">
      <a href="join-the-network.html" class="btn btn-primary">Join the Network</a>
    </div>
  </div>
  
  <!-- HERO SECTION -->
  <header class="hero homepage-hero">
    <div class="hero__ring-container">
      <img src="../assets/refi-dao-ring.png" alt="" class="hero__ring" data-parallax="0.3">
    </div>
    <div class="hero__ring-mask"></div>
    
    <div class="hero__content">
      <div class="hero__glow"></div>
      
      <div class="fade-in-up">
        <span class="pill-badge">ReFi DAO</span>
        <h1 class="hero__title">
          A network society to<br class="desktop-only">
          <span class="gradient-text">regenerate the earth</span>
        </h1>
        <p class="hero__subtitle">
          Connecting regenerative movements globally, empowering communities to co-create 
          a future rooted in social equity, economic opportunity, and ecological restoration.
        </p>
      </div>
      
      <div class="hero__actions fade-in-up fade-in-delay-1">
        <a href="#explore" class="btn btn-primary btn-lg">Explore the Network</a>
        <a href="local-nodes.html" class="btn btn-ghost btn-lg">Find Local Nodes</a>
      </div>
    </div>
    
    <div class="scroll-indicator fade-in-up fade-in-delay-2">
      <span class="scroll-indicator__text">Scroll to explore</span>
      <div class="scroll-indicator__line">
        <div class="scroll-indicator__bead"></div>
      </div>
    </div>
  </header>
  
  <!-- MAP PREVIEW SECTION -->
  <section id="explore" class="section section-lg" style="background: var(--color-bg-deep);">
    <div class="container">
      <div class="section-header" data-animate>
        <span class="pill-badge pill-badge--green section-header__badge">Global Network</span>
        <h2 class="section-header__title">ReFi Local Nodes</h2>
        <p class="section-header__subtitle">
          Explore the network of place-based Regenerative Finance communities around the world.
        </p>
      </div>
      
      <div class="map-preview" data-animate data-animate-delay="200" style="position: relative; min-height: 500px;">
        <div class="map-frame" style="position: relative; border-radius: var(--radius-2xl); overflow: hidden;">
          <img src="../../refi-node-map/assets/dot-map.png" alt="World map" class="map-image" style="width: 100%; height: auto; display: block; opacity: 0.95;">
          
          <div class="tour-layer" id="tourLayerLanding" aria-hidden="true" style="position: absolute; inset: 0; z-index: 2; pointer-events: none;">
            <svg class="tour-layer__svg" id="tourSvgLanding" viewBox="0 0 100 100" preserveAspectRatio="none" style="width: 100%; height: 100%; display: block;">
              <path id="tourPathLanding" d="" style="fill: none; stroke: rgba(113, 227, 186, 0.8); stroke-width: 1.4; stroke-linecap: round; stroke-dasharray: 2.2 2.4;"></path>
            </svg>
          </div>
          
          <div class="map-pins" id="mapPinsLanding" aria-label="Map pins" style="position: absolute; inset: 0; z-index: 3; pointer-events: auto;"></div>
          
          <div class="map-actions" style="position: absolute; right: 1rem; top: 1rem; z-index: 6; display: flex; gap: 0.75rem;">
            <a href="local-nodes.html" class="ghost-button" style="display: inline-flex; align-items: center; gap: 0.75rem; padding: 0.65rem 1.25rem; border-radius: 9999px; background: rgba(255, 255, 255, 0.06); border: 1px solid rgba(255, 255, 255, 0.12); color: rgba(241, 240, 255, 0.9); font-weight: 500; font-size: 0.875rem; text-decoration: none; transition: transform 0.2s, border-color 0.2s, color 0.2s;">Explore Full Map</a>
          </div>
        </div>
      </div>
      
      <!-- Node Modal for Landing Page -->
      <dialog class="modal node-modal" id="nodeModalLanding">
        <div class="modal-header node-modal__header">
          <div class="node-modal__hero" id="modalHeroLanding" hidden>
            <img class="node-modal__heroImg" id="modalHeroImgLanding" alt="">
          </div>
          <div class="node-modal__identity">
            <img class="node-modal__logo" id="modalLogoLanding" alt="" hidden>
            <div class="node-modal__titlegroup">
              <div class="modal-title" id="modalTitleLanding"></div>
              <div class="modal-meta node-modal__meta" id="modalMetaLanding"></div>
              <div class="node-modal__years" id="modalYearsLanding" hidden>
                <span class="node-modal__yearsLabel">Updates</span>
                <div class="node-modal__yearTabs" id="modalYearTabsLanding" aria-label="Select update year"></div>
              </div>
            </div>
          </div>
          <button class="modal-close" id="modalCloseLanding" type="button" aria-label="Close">√ó</button>
        </div>
        <div class="modal-body node-modal__body">
          <div class="prose node-modal__content" id="modalContentLanding"></div>
        </div>
      </dialog>
    </div>
  </section>
  
  <!-- STATS SECTION -->
  <section class="section stats-section">
    <div class="container">
      <div class="stats-grid card-grid">
        <div class="glass-card stat-card" data-animate>
          <div class="stat-card__value gradient-text" data-counter="29" data-counter-suffix="+">0</div>
          <div class="stat-card__label">Local Nodes</div>
        </div>
        <div class="glass-card stat-card" data-animate data-animate-delay="100">
          <div class="stat-card__value gradient-text" data-counter="22" data-counter-suffix="+">0</div>
          <div class="stat-card__label">Countries</div>
        </div>
        <div class="glass-card stat-card" data-animate data-animate-delay="200">
          <div class="stat-card__value gradient-text" data-counter="5000" data-counter-suffix="+">0</div>
          <div class="stat-card__label">Community Members</div>
        </div>
        <div class="glass-card stat-card" data-animate data-animate-delay="300">
          <div class="stat-card__value gradient-text" data-counter="4" data-counter-suffix="+">0</div>
          <div class="stat-card__label">Network Initiatives</div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- WHAT WE DO SECTION -->
  <section class="section section-lg features-section">
    <div class="container">
      <div class="section-header" data-animate>
        <h2 class="section-header__title">What We Do</h2>
        <p class="section-header__subtitle">
          ReFi DAO serves as a hub where regenerative finance meets collective action.
        </p>
      </div>
      
      <div class="card-grid">
        <div class="glass-card feature-card" data-animate>
          <div class="feature-card__icon">üß†</div>
          <h3 class="feature-card__title">Sense-making</h3>
          <p class="feature-card__description">
            Understanding the regenerative finance landscape and mapping opportunities for impact.
          </p>
        </div>
        
        <div class="glass-card feature-card" data-animate data-animate-delay="100">
          <div class="feature-card__icon">üìö</div>
          <h3 class="feature-card__title">Education</h3>
          <p class="feature-card__description">
            Spreading knowledge about ReFi through workshops, resources, and community learning.
          </p>
        </div>
        
        <div class="glass-card feature-card" data-animate data-animate-delay="200">
          <div class="feature-card__icon">üå±</div>
          <h3 class="feature-card__title">Opportunity Development</h3>
          <p class="feature-card__description">
            Connecting regenerative projects with resources, partners, and funding opportunities.
          </p>
        </div>
        
        <div class="glass-card feature-card" data-animate data-animate-delay="300">
          <div class="feature-card__icon">üí∞</div>
          <h3 class="feature-card__title">Fundraising Support</h3>
          <p class="feature-card__description">
            Helping regenerative projects access funding through grants, donations, and partnerships.
          </p>
        </div>
        
        <div class="glass-card feature-card" data-animate data-animate-delay="400">
          <div class="feature-card__icon">üöÄ</div>
          <h3 class="feature-card__title">Onboarding & Empowerment</h3>
          <p class="feature-card__description">
            Supporting new participants in joining the regenerative finance movement.
          </p>
        </div>
        
        <div class="glass-card feature-card" data-animate data-animate-delay="500">
          <div class="feature-card__icon">üåç</div>
          <h3 class="feature-card__title">Network Building</h3>
          <p class="feature-card__description">
            Weaving connections across local nodes and global movements for collective impact.
          </p>
        </div>
      </div>
    </div>
  </section>
  
  <!-- RESOURCES SECTION -->
  <section class="section section-lg resources-section">
    <div class="container">
      <div class="section-header" data-animate>
        <h2 class="section-header__title">Explore ReFi DAO</h2>
        <p class="section-header__subtitle">
          Discover our resources, connect with communities, and learn how to get involved.
        </p>
      </div>
      
      <div class="card-grid">
        <a href="resources-hub.html" class="glass-card glass-card--interactive resource-card" data-animate>
          <div class="resource-card__icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
            </svg>
          </div>
          <h3 class="resource-card__title">Resources Hub</h3>
          <p class="resource-card__description">
            Comprehensive documentation, guides, and tools for understanding and participating in ReFi DAO.
          </p>
          <span class="resource-card__link">Explore Resources ‚Üí</span>
        </a>
        
        <a href="community.html" class="glass-card glass-card--interactive resource-card" data-animate data-animate-delay="100">
          <div class="resource-card__icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
          </div>
          <h3 class="resource-card__title">Community</h3>
          <p class="resource-card__description">
            Find local nodes, explore network initiatives, and connect with regenerative finance communities.
          </p>
          <span class="resource-card__link">Find Communities ‚Üí</span>
        </a>
        
        <a href="https://blog.refidao.com" target="_blank" class="glass-card glass-card--interactive resource-card" data-animate data-animate-delay="200">
          <div class="resource-card__icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
          </div>
          <h3 class="resource-card__title">Media</h3>
          <p class="resource-card__description">
            Articles, podcasts, videos, and stories from the regenerative finance movement.
          </p>
          <span class="resource-card__link">Browse Media ‚Üó</span>
        </a>
      </div>
    </div>
  </section>
  
  <!-- CTA SECTION -->
  <section class="cta-section">
    <div class="cta-section__glow"></div>
    <div class="cta-section__content container">
      <h2 class="cta-section__title" data-animate>Join the Network</h2>
      <p class="cta-section__text" data-animate data-animate-delay="100">
        Ready to get involved? Join the ReFi DAO community and start contributing to regenerative finance.
      </p>
      <div class="hero__actions" data-animate data-animate-delay="200">
        <a href="join-the-network.html" class="btn btn-primary btn-lg">Join the Network</a>
        <a href="local-nodes.html" class="btn btn-ghost btn-lg">Find Local Nodes</a>
      </div>
    </div>
  </section>
  
  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer__content">
      <div class="footer__logo">
        <img src="../assets/ReFi_Logomark.svg" alt="ReFi DAO" class="footer__logo-img">
      </div>
      <p class="footer__tagline">A network society to regenerate the earth</p>
      
      <nav class="footer__links">
        <a href="about.html" class="footer__link">About</a>
        <a href="local-nodes.html" class="footer__link">Local Nodes</a>
        <a href="community.html" class="footer__link">Community</a>
        <a href="resources-hub.html" class="footer__link">Resources</a>
        <a href="https://blog.refidao.com" target="_blank" class="footer__link">Blog</a>
        <a href="https://forum.refidao.com" target="_blank" class="footer__link">Forum</a>
        <a href="https://docs.refidao.com" target="_blank" class="footer__link">Docs</a>
      </nav>
      
      <div class="footer__social">
        <a href="https://twitter.com/ReFiDAOist" target="_blank" class="footer__social-link" aria-label="Twitter">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
        </a>
        <a href="https://discord.gg/refidao" target="_blank" class="footer__social-link" aria-label="Discord">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
          </svg>
        </a>
        <a href="https://github.com/ReFiDAO" target="_blank" class="footer__social-link" aria-label="GitHub">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
        <a href="https://t.me/refidao" target="_blank" class="footer__social-link" aria-label="Telegram">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
          </svg>
        </a>
      </div>
      
      <p class="footer__copyright">¬© 2026 ReFi DAO. All rights reserved.</p>
    </div>
  </footer>
  
  <!-- Scripts -->
  <script type="module" src="../scripts/main.js"></script>
  
  <!-- Node Map Scripts for Landing Page -->
  <script>
    // Initialize map for landing page with unique IDs
    (function() {
      // Wait for node data to load
      function initLandingMap() {
        if (typeof window.__NODE_DATA__ === 'undefined') {
          setTimeout(initLandingMap, 100);
          return;
        }
        
        // Create a modified version of the map initialization for landing page
        const nodes = Array.isArray(window.__NODE_DATA__) ? window.__NODE_DATA__ : [];
        const mapPins = document.getElementById('mapPinsLanding');
        const modal = document.getElementById('nodeModalLanding');
        const modalTitle = document.getElementById('modalTitleLanding');
        const modalMeta = document.getElementById('modalMetaLanding');
        const modalContent = document.getElementById('modalContentLanding');
        const modalHero = document.getElementById('modalHeroLanding');
        const modalHeroImg = document.getElementById('modalHeroImgLanding');
        const modalClose = document.getElementById('modalCloseLanding');
        const modalLogo = document.getElementById('modalLogoLanding');
        const modalYears = document.getElementById('modalYearsLanding');
        const modalYearTabs = document.getElementById('modalYearTabsLanding');
        
        if (!mapPins) return;
        
        // Use the same functions from script.js but with landing page IDs
        // We'll use a simplified version that reuses the main script functions
        // For now, just render pins and handle clicks
        const BASE_PATH = (function() {
          const scripts = document.getElementsByTagName('script');
          for (let script of scripts) {
            if (script.src && script.src.includes('refi-node-map/script.js')) {
              const match = script.src.match(/(.*\/)refi-node-map\/script\.js/);
              if (match) return match[1] + 'refi-node-map/';
            }
          }
          return '';
        })();
        
        function escapeHtml(value) {
          return String(value || "").replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll('"', "&quot;").replaceAll("'", "&#039;");
        }
        
        function nodePoint(node) {
          if (Number.isFinite(node.lat) && Number.isFinite(node.lng)) {
            const x = ((Number(node.lng) + 180) / 360) * 100;
            const y = ((90 - Number(node.lat)) / 180) * 100;
            return { xPct: Math.max(0, Math.min(100, x)), yPct: Math.max(0, Math.min(100, y)) };
          }
          if (typeof node.mapCoordinates === "string") {
            const matchX = node.mapCoordinates.match(/xPct\s*:\s*([0-9.]+)/i);
            const matchY = node.mapCoordinates.match(/yPct\s*:\s*([0-9.]+)/i);
            const x = matchX ? Number(matchX[1]) : NaN;
            const y = matchY ? Number(matchY[1]) : NaN;
            if (Number.isFinite(x) && Number.isFinite(y)) {
              return { xPct: x, yPct: y };
            }
          }
          if (Number.isFinite(node.xPct) && Number.isFinite(node.yPct)) {
            return { xPct: node.xPct, yPct: node.yPct };
          }
          return { xPct: 50, yPct: 50 };
        }
        
        function getFlagEmoji(node) {
          const FLAG_BY_ID = {
            "refi-belo-horizonte": "üáßüá∑", "refi-bogota": "üá®üá¥", "refi-cape-town": "üáøüá¶",
            "refi-colombia": "üá®üá¥", "refi-phangan": "üáπüá≠", "refi-red-hook": "üá∫üá∏",
            "refi-the-hague": "üá≥üá±", "refi-venezuela": "üáªüá™", "refi-atlantico": "üá®üá¥",
            "refi-barcelona": "üá™üá∏", "refi-bay-area": "üá∫üá∏", "refi-costa-rica": "üá®üá∑",
            "refi-italia": "üáÆüáπ", "refi-lagos": "üá≥üá¨", "refi-lisboa": "üáµüáπ",
            "refi-medellin": "üá®üá¥", "refi-mexico": "üá≤üáΩ", "refi-portland": "üá∫üá∏",
            "refi-tanzania": "üáπüáø", "refi-tulum": "üá≤üáΩ", "refi-uganda": "üá∫üá¨",
            "rifai-sicilia": "üáÆüáπ", "refi-geneva": "üá®üá≠", "refi-hong-kong": "üá≠üá∞",
            "refi-london": "üá¨üáß", "refi-miami": "üá∫üá∏", "refi-paramaribo": "üá∏üá∑",
            "refi-singapore": "üá∏üá¨", "refi-toronto": "üá®üá¶"
          };
          return FLAG_BY_ID[node.id] || "üåç";
        }
        
        // Render pins using the same structure as the main map
        mapPins.innerHTML = nodes.map((node) => {
          const { xPct, yPct } = nodePoint(node);
          const location = node.location || "TBD";
          const stage = node.nodeStage || "TBD";
          const lastUpdate = node.lastUpdate || "TBD";
          const flag = getFlagEmoji(node);
          return `
            <button class="pin" type="button" data-node-id="${escapeHtml(node.id)}" style="left:${xPct}%; top:${yPct}%;">
              <span class="pin__dot" aria-hidden="true"></span>
              <div class="pin__bubble" aria-hidden="true">
                <div class="pin__title">
                  <span class="pin__flag" aria-hidden="true">${escapeHtml(flag)}</span>
                  <span class="pin__label">${escapeHtml(node.name)}</span>
                </div>
                <div class="pin__meta">
                  <div class="pin__metaRow">
                    <span class="pin__metaLabel">Location</span>
                    <span class="pin__metaValue">${escapeHtml(location)}</span>
                  </div>
                  <div class="pin__metaRow">
                    <span class="pin__metaLabel">Stage</span>
                    <span class="pin__metaValue">${escapeHtml(stage)}</span>
                  </div>
                  <div class="pin__metaRow">
                    <span class="pin__metaLabel">Last Update</span>
                    <span class="pin__metaValue">${escapeHtml(lastUpdate)}</span>
                  </div>
                </div>
              </div>
            </button>
          `;
        }).join("");
        
        // Hover effects are handled by CSS, no need for JavaScript
        
        // Handle pin clicks - redirect to full map page with node ID
        mapPins.addEventListener('click', (e) => {
          const pin = e.target.closest('.pin[data-node-id]');
          if (pin) {
            const nodeId = pin.dataset.nodeId;
            window.location.href = `local-nodes.html#node-${nodeId}`;
          }
        });
      }
      
      // Load node data first
      const script = document.createElement('script');
      script.src = '../../refi-node-map/nodes/nodes-data.js';
      script.onload = initLandingMap;
      script.onerror = () => console.error('Failed to load node data');
      document.head.appendChild(script);
    })();
  </script>
</body>
</html>
